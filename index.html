<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Medicine Dispenser | Dashboard</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== GLOWING DARK THEME WITH LIGHT COLORS ===== */
        :root {
            /* Glowing Light Color Palette */
            --glow-primary: #7dd3fc;
            --glow-primary-light: #e0f2fe;
            --glow-secondary: #a5f3fc;
            --glow-accent: #c7d2fe;
            --glow-success: #99f6e4;
            --glow-warning: #fde68a;
            --glow-danger: #fecaca;

            /* Dark Backgrounds with Glow Effects */
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-card-light: #2d3748;
            --border-glow: rgba(125, 211, 252, 0.3);

            /* Text Colors */
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;

            /* Glow Effects */
            --glow-intensity: 0.5;
            --glow-primary-shadow: 0 0 10px rgba(125, 211, 252, var(--glow-intensity));
            --glow-secondary-shadow: 0 0 10px rgba(165, 243, 252, var(--glow-intensity));
            --glow-success-shadow: 0 0 10px rgba(153, 246, 228, var(--glow-intensity));

            /* Consistent Spacing Variables */
            --space-xs: 0.5rem;
            --space-sm: 1rem;
            --space-md: 1.5rem;
            --space-lg: 2rem;
            --space-xl: 3rem;
            --space-xxl: 4rem;

            /* Consistent Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;

            /* Typography */
            --font-primary: 'Segoe UI', system-ui, -apple-system, sans-serif;
            --font-mono: 'JetBrains Mono', 'Cascadia Code', monospace;

            /* Transitions */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* ===== BASE STYLES WITH CONSISTENT PADDING ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-primary);
            background-color: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            background-image:
                radial-gradient(circle at 20% 30%, rgba(125, 211, 252, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(165, 243, 252, 0.1) 0%, transparent 50%);
            padding: var(--space-sm);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: var(--bg-card);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border-glow);
            box-shadow:
                0 0 30px rgba(125, 211, 252, 0.2),
                inset 0 0 30px rgba(125, 211, 252, 0.05);
            overflow: hidden;
            transition: var(--transition-normal);
        }

        .container:hover {
            box-shadow:
                0 0 40px rgba(125, 211, 252, 0.3),
                inset 0 0 30px rgba(125, 211, 252, 0.08);
        }

        /* ===== HEADER WITH GLOW EFFECTS ===== */
        header {
            background: linear-gradient(135deg, #1a2036 0%, #1e293b 100%);
            padding: var(--space-lg);
            border-bottom: 1px solid var(--border-glow);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg,
                    transparent,
                    var(--glow-primary),
                    transparent);
            animation: scanline 4s linear infinite;
        }

        @keyframes scanline {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .header-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            padding: var(--space-md) 0;
        }

        @media (min-width: 768px) {
            .header-content {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-sm);
        }

        .logo-icon {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--glow-primary), var(--glow-accent));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: var(--bg-dark);
            box-shadow: var(--glow-primary-shadow);
            animation: pulse-glow 3s infinite alternate;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 10px rgba(125, 211, 252, 0.5);
                transform: scale(1);
            }

            50% {
                box-shadow: 0 0 20px rgba(125, 211, 252, 0.8);
                transform: scale(1.05);
            }
        }

        .logo-text {
            flex: 1;
        }

        .logo-text h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--glow-primary), var(--glow-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-xs);
            text-shadow: 0 0 20px rgba(125, 211, 252, 0.3);
        }

        .logo-text p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            background-color: rgba(30, 41, 59, 0.8);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-glow);
            backdrop-filter: blur(10px);
            max-width: 300px;
            margin: 0 auto;
            width: 100%;
        }

        @media (min-width: 768px) {
            .status-indicator {
                margin: 0;
                width: auto;
            }
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--glow-warning);
            box-shadow: 0 0 10px var(--glow-warning);
            animation: status-pulse 2s infinite;
        }

        @keyframes status-pulse {

            0%,
            100% {
                opacity: 1;
                box-shadow: 0 0 10px var(--glow-warning);
            }

            50% {
                opacity: 0.7;
                box-shadow: 0 0 20px var(--glow-warning);
            }
        }

        #connection-status {
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        /* ===== MAIN CONTENT AREA ===== */
        main {
            padding: var(--space-lg);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-lg);
            padding: var(--space-md) 0;
        }

        @media (min-width: 1024px) {
            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }

            .dashboard .card:nth-child(3) {
                grid-column: span 2;
            }
        }

        /* ===== CARD STYLES WITH CONSISTENT PADDING ===== */
        .card {
            background: linear-gradient(145deg, var(--bg-card-light), var(--bg-card));
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-glow);
            padding: var(--space-lg);
            transition: var(--transition-normal);
            box-shadow:
                0 4px 20px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow:
                0 8px 30px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(125, 211, 252, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .card-header {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            padding-bottom: var(--space-md);
            margin-bottom: var(--space-md);
            border-bottom: 1px solid var(--border-glow);
        }

        @media (min-width: 640px) {
            .card-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--glow-primary);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .card-title i {
            color: var(--glow-secondary);
            filter: drop-shadow(0 0 5px currentColor);
        }

        .badge {
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-md);
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
            text-align: center;
            min-width: 80px;
        }

        .badge-success {
            background-color: rgba(153, 246, 228, 0.15);
            color: var(--glow-success);
            border: 1px solid rgba(153, 246, 228, 0.3);
            box-shadow: 0 0 10px rgba(153, 246, 228, 0.2);
        }

        /* ===== FORM STYLES ===== */
        #medicine-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            padding: var(--space-md) 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .form-label {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--glow-primary-light);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .form-label i {
            color: var(--glow-secondary);
            font-size: 1.1rem;
        }

        .form-control {
            padding: var(--space-md);
            background-color: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-glow);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition-fast);
            width: 100%;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--glow-primary);
            box-shadow:
                0 0 0 3px rgba(125, 211, 252, 0.1),
                var(--glow-primary-shadow);
        }

        /* ===== DAYS SELECTION ===== */
        .days-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: var(--space-sm);
            padding: var(--space-sm) 0;
        }

        .day-checkbox {
            display: none;
        }

        .day-label {
            padding: var(--space-sm);
            background-color: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-glow);
            border-radius: var(--radius-md);
            text-align: center;
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .day-checkbox:checked+.day-label {
            background-color: rgba(125, 211, 252, 0.2);
            color: var(--glow-primary);
            border-color: var(--glow-primary);
            box-shadow: var(--glow-primary-shadow);
        }

        .day-label:hover {
            background-color: rgba(125, 211, 252, 0.1);
            border-color: var(--glow-primary);
        }

        /* ===== BUTTON STYLES WITH GLOW ===== */
        .btn {
            padding: var(--space-md);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--glow-success), #0d9488);
            color: var(--bg-dark);
            box-shadow:
                0 4px 15px rgba(13, 148, 136, 0.3),
                0 0 15px rgba(153, 246, 228, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow:
                0 6px 20px rgba(13, 148, 136, 0.4),
                0 0 20px rgba(153, 246, 228, 0.5);
        }

        .btn-outline {
            background: transparent;
            color: var(--glow-primary);
            border: 1px solid var(--glow-primary);
            box-shadow: 0 0 10px rgba(125, 211, 252, 0.2);
        }

        .btn-outline:hover {
            background-color: rgba(125, 211, 252, 0.1);
            box-shadow: 0 0 20px rgba(125, 211, 252, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--glow-danger), #dc2626);
            color: rgb(0, 0, 0);
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
        }

        /* ===== SYNC STATUS ===== */
        .sync-status {
            background: linear-gradient(145deg, rgba(15, 23, 42, 0.5), rgba(30, 41, 59, 0.5));
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-top: var(--space-xl);
            border: 1px solid var(--border-glow);
        }

        .sync-header {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            padding-bottom: var(--space-md);
            margin-bottom: var(--space-md);
            border-bottom: 1px solid var(--border-glow);
        }

        @media (min-width: 640px) {
            .sync-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .sync-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .sync-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--glow-success);
            box-shadow: 0 0 10px var(--glow-success);
            animation: sync-pulse 1.5s infinite;
        }

        @keyframes sync-pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .time-display-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-md);
            padding: var(--space-md) 0;
        }

        @media (min-width: 640px) {
            .time-display-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .time-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: var(--space-xs);
        }

        .time-display {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--glow-primary);
            background-color: rgba(15, 23, 42, 0.7);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-glow);
            text-align: center;
            box-shadow: inset 0 0 20px rgba(125, 211, 252, 0.1);
        }

        /* ===== SCHEDULE LIST ===== */
        .schedule-list {
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            padding: var(--space-sm);
            margin: var(--space-md) 0;
            border-radius: var(--radius-md);
            background-color: rgba(15, 23, 42, 0.3);
        }

        .schedule-item {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(45, 55, 72, 0.8));
            border-radius: var(--radius-md);
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            border-left: 4px solid var(--glow-primary);
            transition: var(--transition-fast);
        }

        .schedule-item:hover {
            transform: translateX(4px);
            border-left-color: var(--glow-secondary);
            box-shadow: 0 0 15px rgba(125, 211, 252, 0.3);
        }

        .empty-schedule {
            text-align: center;
            padding: var(--space-xl);
            color: var(--text-muted);
        }

        .empty-schedule i {
            font-size: 3rem;
            margin-bottom: var(--space-md);
            opacity: 0.5;
        }

        /* ===== PROGRESS BAR ===== */
        .progress-container {
            height: 10px;
            background-color: rgba(15, 23, 42, 0.5);
            border-radius: 5px;
            overflow: hidden;
            margin: var(--space-md) 0;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--glow-primary), var(--glow-secondary));
            border-radius: 5px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--glow-primary);
        }

        /* ===== ACTIVITY LOG ===== */
        .log-list {
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
            padding: var(--space-md);
            margin: var(--space-md) 0;
            border-radius: var(--radius-md);
            background-color: rgba(15, 23, 42, 0.3);
            border: 1px solid var(--border-glow);
        }

        .log-item {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            border-bottom: 1px solid rgba(125, 211, 252, 0.1);
            font-size: 0.9rem;
        }

        .log-type {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--glow-primary);
            margin-top: 5px;
            box-shadow: 0 0 5px var(--glow-primary);
        }

        .log-time {
            color: var(--glow-secondary);
            font-family: var(--font-mono);
            font-size: 0.85rem;
        }

        .log-message {
            color: var(--text-secondary);
            grid-column: 2;
        }

        /* ===== FOOTER ===== */
        footer {
            background: linear-gradient(145deg, #1a2036, #1e293b);
            padding: var(--space-xl) var(--space-lg);
            border-top: 1px solid var(--border-glow);
            margin-top: var(--space-xl);
        }

        .footer-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-xl);
            padding-bottom: var(--space-lg);
            margin-bottom: var(--space-lg);
            border-bottom: 1px solid var(--border-glow);
        }

        @media (min-width: 768px) {
            .footer-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: var(--space-lg);
            }
        }

        .footer-section {
            padding: var(--space-md);
        }

        .footer-section h4 {
            font-size: 1.1rem;
            color: var(--glow-primary);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .footer-section h4 i {
            color: var(--glow-secondary);
        }

        .footer-section p {
            color: var(--text-secondary);
            margin-bottom: var(--space-sm);
            font-size: 0.95rem;
            padding-left: var(--space-sm);
        }

        footer>p {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
            padding-top: var(--space-lg);
        }

        /* ===== TOAST NOTIFICATION ===== */
        .toast {
            position: fixed;
            bottom: var(--space-lg);
            right: var(--space-lg);
            background: linear-gradient(145deg, var(--bg-card-light), var(--bg-card));
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-md);
            max-width: 400px;
            border: 1px solid var(--border-glow);
            box-shadow:
                0 10px 30px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(125, 211, 252, 0.2);
            transform: translateX(150%);
            transition: transform var(--transition-normal);
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-icon {
            font-size: 1.5rem;
            color: var(--glow-primary);
        }

        .toast-content {
            flex: 1;
        }

        #toast-title {
            font-size: 1rem;
            color: var(--glow-primary);
            margin-bottom: var(--space-xs);
            display: block;
        }

        #toast-message {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* ===== SCROLLBAR STYLING ===== */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: var(--radius-sm);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--glow-primary), var(--glow-secondary));
            border-radius: var(--radius-sm);
            border: 2px solid var(--bg-card);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(var(--glow-secondary), var(--glow-primary));
            box-shadow: 0 0 10px var(--glow-primary);
        }

        /* ===== RESPONSIVE ADJUSTMENTS ===== */
        @media (max-width: 768px) {
            :root {
                --space-xs: 0.4rem;
                --space-sm: 0.8rem;
                --space-md: 1.2rem;
                --space-lg: 1.6rem;
                --space-xl: 2.4rem;
            }

            html {
                font-size: 14px;
            }

            body {
                padding: var(--space-xs);
            }

            .container {
                border-radius: var(--radius-lg);
            }

            header,
            main,
            footer {
                padding: var(--space-md);
            }

            .logo {
                flex-direction: column;
                text-align: center;
                gap: var(--space-sm);
            }

            .logo-icon {
                width: 56px;
                height: 56px;
                font-size: 24px;
            }

            .dashboard {
                gap: var(--space-md);
            }

            .card {
                padding: var(--space-md);
            }

            .days-selection {
                grid-template-columns: repeat(4, 1fr);
            }

            .footer-grid {
                gap: var(--space-lg);
            }
        }

        @media (max-width: 480px) {
            :root {
                --space-xs: 0.3rem;
                --space-sm: 0.6rem;
                --space-md: 1rem;
                --space-lg: 1.4rem;
                --space-xl: 2rem;
            }

            .days-selection {
                grid-template-columns: repeat(3, 1fr);
            }

            .btn {
                padding: var(--space-sm);
                font-size: 0.9rem;
            }

            .time-display {
                font-size: 1.2rem;
                padding: var(--space-sm);
            }

            .toast {
                left: var(--space-sm);
                right: var(--space-sm);
                bottom: var(--space-sm);
                max-width: none;
            }
        }

        /* ===== PRINT STYLES ===== */
        @media print {
            .container {
                box-shadow: none;
                border: 1px solid #ccc;
            }

            .btn,
            .status-indicator,
            .toast {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-pills"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Smart Medicine Dispenser</h1>
                        <p>Automated Medication Management System</p>
                    </div>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="status-dot"></div>
                    <span id="connection-status">Initializing System...</span>
                </div>
            </div>
        </header>

        <main>
            <div class="dashboard">
                <!-- Schedule Medicine Card -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-calendar-plus"></i>
                            Schedule Medicine
                        </h2>
                        <span class="badge badge-success" id="active-count">0 Active</span>
                    </div>
                    <form id="medicine-form">
                        <div class="form-group">
                            <label class="form-label" for="medicine-name">
                                <i class="fas fa-capsules"></i> Medication Name
                            </label>
                            <input type="text" id="medicine-name" class="form-control" placeholder="Brand & Generic"
                                required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="dosage">
                                <i class="fas fa-prescription-bottle"></i> Purpose
                            </label>
                            <input type="text" id="dosage" class="form-control" placeholder="Indication" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="schedule-time">
                                <i class="fas fa-clock"></i> Schedule Time (24-hour)
                            </label>
                            <input type="time" id="schedule-time" class="form-control" step="60" required>
                            <div style="font-size: 0.85rem; color: var(--gray); margin-top: 8px;">
                                <i class="fas fa-info-circle"></i> Format: HH:MM (24-hour clock)
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-calendar-week"></i> Repeat Days
                            </label>
                            <div class="days-selection">
                                <input type="checkbox" id="day-sun" class="day-checkbox" name="days" value="1">
                                <label for="day-sun" class="day-label">Sun</label>

                                <input type="checkbox" id="day-mon" class="day-checkbox" name="days" value="1">
                                <label for="day-mon" class="day-label">Mon</label>

                                <input type="checkbox" id="day-tue" class="day-checkbox" name="days" value="1">
                                <label for="day-tue" class="day-label">Tue</label>

                                <input type="checkbox" id="day-wed" class="day-checkbox" name="days" value="1">
                                <label for="day-wed" class="day-label">Wed</label>

                                <input type="checkbox" id="day-thu" class="day-checkbox" name="days" value="1">
                                <label for="day-thu" class="day-label">Thu</label>

                                <input type="checkbox" id="day-fri" class="day-checkbox" name="days" value="1">
                                <label for="day-fri" class="day-label">Fri</label>

                                <input type="checkbox" id="day-sat" class="day-checkbox" name="days" value="1">
                                <label for="day-sat" class="day-label">Sat</label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success" id="add-schedule-btn">
                            <i class="fas fa-plus-circle"></i> Add to Schedule
                        </button>
                    </form>

                    <div class="sync-status">
                        <div class="sync-header">
                            <div class="sync-indicator">
                                <div class="sync-dot" id="sync-dot"></div>
                                <span id="sync-status-text">Time Synchronization</span>
                            </div>
                            <button class="btn btn-outline" id="force-sync-btn" style="width: auto; padding: 8px 16px;">
                                <i class="fas fa-sync-alt"></i> Sync Now
                            </button>
                        </div>
                        <div class="time-display-container">
                            <div class="time-label">DS3231 RTC Time</div>
                            <div class="time-display" id="rtc-time-display">--:--:--</div>
                            <div class="time-label">Real-time Synchronized</div>
                        </div>
                    </div>
                </div>

                <!-- Today's Schedule Card -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-calendar-day"></i>
                            Today's Schedule
                        </h2>
                        <div class="time-display" id="current-time-display"
                            style="font-size: 1.2rem; color: var(--primary); font-weight: 600;">
                            --:--:--
                        </div>
                    </div>
                    <div class="schedule-list" id="schedule-list">
                        <div class="schedule-item empty-schedule"
                            style="text-align: center; padding: 40px 20px; border-left: 4px solid var(--gray-light);">
                            <i class="fas fa-calendar-alt"
                                style="font-size: 3rem; color: var(--gray-light); margin-bottom: 15px;"></i>
                            <h3 style="color: var(--gray); margin-bottom: 10px; font-weight: 500;">No Schedule for Today
                            </h3>
                            <p style="color: var(--gray-light);">Add medicines using the schedule form</p>
                        </div>
                    </div>
                    <div style="margin-top: 25px;">
                        <div class="progress-container">
                            <div class="progress-bar" id="schedule-progress" style="width: 0%"></div>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; margin-top: 12px; color: var(--gray); font-size: 0.9rem;">
                            <span>
                                <i class="fas fa-history"></i>
                                Next check: <span id="next-check-timer">60</span>s
                            </span>
                            <span>
                                <span id="dispensed-count">0</span> dispensed â€¢ <span id="pending-count">0</span>
                                pending
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Activity Log Card -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-history"></i>
                            System Activity Log
                        </h2>
                        <div>
                            <button class="btn btn-outline" id="pause-logs-btn"
                                style="width: auto; padding: 8px 16px; margin-right: 10px;">
                                <i class="fas fa-pause"></i> Pause
                            </button>
                            <button class="btn btn-danger" id="clear-logs-btn" style="width: auto; padding: 8px 16px;">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                        </div>
                    </div>
                    <div class="log-list" id="log-list">
                        <div class="log-item log-info">
                            <div class="log-type"></div>
                            <div class="log-time">[System]</div>
                            <div class="log-message">Initializing medication dispenser system...</div>
                        </div>
                    </div>
                    <div
                        style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center; color: var(--gray); font-size: 0.9rem;">
                        <span>
                            <i class="fas fa-database"></i>
                            Log entries: <span id="log-count">1</span>
                        </span>
                        <span>
                            <i class="fas fa-wifi"></i>
                            <span id="firebase-status">Connecting...</span>
                        </span>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <div class="footer-grid">
                <div class="footer-section">
                    <h4><i class="fas fa-microchip"></i> Hardware</h4>
                    <p>ESP32 Microcontroller</p>
                    <p>DS3231 RTC Module</p>
                    <p>1x Servo Motors</p>
                    <p>Buzzer & LED System</p>
                </div>
                <div class="footer-section">
                    <h4><i class="fas fa-sync-alt"></i> Synchronization</h4>
                    <p>Real-time RTC Updates</p>
                    <p>Automatic Time Sync</p>
                    <p>Firebase Cloud Backend</p>
                    <p>24-hour Format</p>
                </div>
                <div class="footer-section">
                    <h4><i class="fas fa-shield-alt"></i> System</h4>
                    <p id="system-uptime">Uptime: --</p>
                    <p id="last-dispense-display">Last Dispense: --:--</p>
                    <p id="total-schedules">Total Schedules: 0</p>
                    <p id="auto-sync-status">Auto Sync: Enabled</p>
                </div>
            </div>
            <p style="margin-top: 25px; opacity: 0.8;">Smart Medicine Reminder & Dispenser v1.0</p>
        </footer>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon">
            <i class="fas fa-info-circle"></i>
        </div>
        <div class="toast-content">
            <strong id="toast-title">Notification</strong>
            <div id="toast-message">Message content</div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBXMrhRaJuvZydIbzp3aYebhu4gYOopxtQ",
            authDomain: "medication-system-d0d0f.firebaseapp.com",
            databaseURL: "https://medication-system-d0d0f-default-rtdb.firebaseio.com",
            projectId: "medication-system-d0d0f",
            storageBucket: "medication-system-d0d0f.firebasestorage.app",
            messagingSenderId: "222165407764",
            appId: "1:222165407764:web:0878f5ab12122f24f7ef01"
        };

        // Global variables
        let db = null;
        let scheduleRef, commandsRef, statusRef, logsRef, rtcRef, autoDispenseRef;
        let connectionStatusElement, firebaseStatusElement;
        let scheduleCheckerInterval;
        let lastScheduleCheck = 0;
        let lastRTCTime = null;
        let logPaused = false;
        let systemStartTime = Date.now();
        const CHECK_INTERVAL = 1000; // Check every 60 seconds
        // Per-schedule debounce storage
        const scheduleDebounceMap = {};
        let cachedSchedules = {};



        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize DOM elements
            connectionStatusElement = document.getElementById('connection-status');
            firebaseStatusElement = document.getElementById('firebase-status');

            // Initialize the rest
            initializeEventListeners();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            setInterval(updateUptime, 1000);

            // Initialize Firebase after DOM is ready
            initializeFirebase();
        });

        function initializeFirebase() {
            try {
                // Initialize Firebase
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();

                // Initialize Firebase references
                scheduleRef = db.ref('medicine_schedule');
                commandsRef = db.ref('commands');
                statusRef = db.ref('status');
                logsRef = db.ref('logs');
                rtcRef = db.ref('rtc_time');
                autoDispenseRef = db.ref('auto_dispense');

                updateConnectionStatus('Connected to Firebase', 'success');
                updateFirebaseStatus('Connected âœ“');
                updateSyncStatus('Synced with Firebase', 'success');

                // Setup Firebase listeners
                setupFirebaseListeners();

                // Start schedule checking
                startScheduleChecking();

                // Start auto sync every 1 second
                setInterval(() => {
                    forceTimeSync();
                }, 1000);

                addLog('Firebase connection established successfully', 'success');

            } catch (error) {
                console.error('Firebase initialization error:', error);
                updateConnectionStatus('Firebase Connection Failed', 'error');
                updateFirebaseStatus('Connection Failed âœ—');
                updateSyncStatus('Firebase connection failed', 'error');
                addLog('Firebase connection failed: ' + error.message, 'error');
                initializeDemoData();
            }
        }

        function initializeEventListeners() {
            // Form submission
            document.getElementById('medicine-form').addEventListener('submit', function (e) {
                e.preventDefault();
                addMedicineSchedule();
            });

            // Force sync button
            document.getElementById('force-sync-btn').addEventListener('click', function () {
                forceTimeSync();
            });

            // Pause logs button
            document.getElementById('pause-logs-btn').addEventListener('click', function () {
                logPaused = !logPaused;
                const btn = document.getElementById('pause-logs-btn');
                const icon = btn.querySelector('i');
                if (logPaused) {
                    btn.innerHTML = '<i class="fas fa-play"></i> Resume';
                    btn.classList.remove('btn-outline');
                    btn.classList.add('btn-success');
                    addLog('Log updates paused', 'warning');
                } else {
                    btn.innerHTML = '<i class="fas fa-pause"></i> Pause';
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline');
                    addLog('Log updates resumed', 'success');
                }
            });

            // Clear logs button
            document.getElementById('clear-logs-btn').addEventListener('click', function () {
                if (confirm('Are you sure you want to clear all logs?')) {
                    clearLogs();
                }
            });
        }

        function setupFirebaseListeners() {
            if (!db) return;

            // Listen for schedule updates
            scheduleRef.on('value', snapshot => {
                cachedSchedules = snapshot.val() || {};
                updateScheduleList(cachedSchedules);
                updateScheduleCounters(cachedSchedules);
            });


            // Listen for RTC time updates
            rtcRef.on('value', (snapshot) => {
                const rtcTime = snapshot.val();
                if (rtcTime) {
                    updateRTCTimeDisplay(rtcTime);
                    lastRTCTime = rtcTime;
                    checkScheduleAgainstTime(rtcTime);
                }
            });

            // Listen for auto-dispense events
            autoDispenseRef.on('value', (snapshot) => {
                const autoDispense = snapshot.val();
                if (autoDispense && autoDispense.triggered) {
                    addLog(`Auto-dispense: ${autoDispense.medicineName} at ${autoDispense.time}`, 'success');
                    showToast('Auto Dispense', `${autoDispense.medicineName} dispensed at ${autoDispense.time}`, 'success');

                    // Reset the trigger after 2 seconds
                    setTimeout(() => {
                        autoDispenseRef.update({ triggered: false });
                    }, 2000);
                }
            });

            // Listen for logs
            logsRef.limitToLast(20).on('value', (snapshot) => {
                if (!logPaused) {
                    const logs = snapshot.val();
                    if (logs) {
                        updateLogDisplay(logs);
                    }
                }
            });

            // Listen for status updates
            statusRef.on('value', (snapshot) => {
                const status = snapshot.val();
                if (status) {
                    if (status.last_dispense) {
                        document.getElementById('last-dispense-display').textContent =
                            `Last Dispense: ${status.last_dispense}`;
                    }
                    if (status.system_status) {
                        updateConnectionStatus(status.system_status, 'success');
                    }
                }
            });
        }

        function addMedicineSchedule() {
            const medicineName = document.getElementById('medicine-name').value.trim();
            const dosage = document.getElementById('dosage').value.trim();
            const scheduleTime = document.getElementById('schedule-time').value;

            // Get selected days
            const selectedDays = [];
            document.querySelectorAll('.day-checkbox:checked').forEach(checkbox => {
                selectedDays.push(parseInt(checkbox.value));
            });

            if (!medicineName || !dosage || !scheduleTime || selectedDays.length === 0) {
                showToast('Validation Error', 'Please fill all fields and select at least one day', 'error');
                return;
            }

            // Validate time format
            const timeRegex = /^([01]?[0-9]|2[0-3]):[0-5][0-9]$/;
            if (!timeRegex.test(scheduleTime)) {
                showToast('Invalid Time', 'Please use HH:MM format (24-hour)', 'error');
                return;
            }

            // ðŸš« Enforce max 1 schedule
            if (cachedSchedules && Object.keys(cachedSchedules).length >= 2) {
                showToast(
                    'Schedule Limit Reached',
                    'Only one schedule is allowed. Please remove the existing schedule first.',
                    'warning'
                );
                return;
            }

            const medicineId = Date.now().toString();
            const scheduleData = {
                id: medicineId,
                name: medicineName,
                dosage: dosage,
                time: scheduleTime, // HH:MM format
                days: selectedDays,
                timestamp: new Date().toISOString(),
                lastDispensedDate: null,
                lastDispensed: null,
                active: true,
                createdAt: Date.now()
            };

            if (db && scheduleRef) {
                scheduleRef.child(medicineId).set(scheduleData)
                    .then(() => {
                        showToast('Schedule Added', `${medicineName} scheduled for ${scheduleTime}`, 'success');
                        addLog(`Scheduled: ${medicineName} at ${scheduleTime}`, 'success');
                        document.getElementById('medicine-form').reset();
                    })
                    .catch((error) => {
                        showToast('Error', 'Failed to add schedule: ' + error.message, 'error');
                        addLog('Failed to add schedule: ' + error.message, 'error');
                    });
            } else {
                // Demo mode
                addLog(`Scheduled: ${medicineName} at ${scheduleTime} (Demo)`, 'success');
                showToast('Demo Mode', 'Schedule added (Demo Mode)', 'warning');
                document.getElementById('medicine-form').reset();
            }
        }

        function updateScheduleList(schedules) {
            const scheduleListElement = document.getElementById('schedule-list');

            if (!schedules || Object.keys(schedules).length === 0) {
                scheduleListElement.innerHTML = `
                    <div class="schedule-item empty-schedule" style="text-align: center; padding: 40px 20px; border-left: 4px solid var(--gray-light);">
                        <i class="fas fa-calendar-alt" style="font-size: 3rem; color: var(--gray-light); margin-bottom: 15px;"></i>
                        <h3 style="color: var(--gray); margin-bottom: 10px; font-weight: 500;">No Schedule for Today</h3>
                        <p style="color: var(--gray-light);">Add medicines using the schedule form</p>
                    </div>`;
                return;
            }

            // Get current day (0 = Sunday, 1 = Monday, etc.)
            const today = new Date().getDay();

            // Convert to array, filter for today, and sort by time
            const scheduleArray = Object.values(schedules)
                .filter(schedule => schedule.active && schedule.days && schedule.days.includes(today))
                .sort((a, b) => a.time.localeCompare(b.time));

            if (scheduleArray.length === 0) {
                scheduleListElement.innerHTML = `
                    <div class="schedule-item empty-schedule" style="text-align: center; padding: 40px 20px; border-left: 4px solid var(--gray-light);">
                        <i class="fas fa-calendar-alt" style="font-size: 3rem; color: var(--gray-light); margin-bottom: 15px;"></i>
                        <h3 style="color: var(--gray); margin-bottom: 10px; font-weight: 500;">No Schedule for Today</h3>
                        <p style="color: var(--gray-light);">Add medicines for today using the form</p>
                    </div>`;
                return;
            }

            let html = '';
            scheduleArray.forEach(schedule => {
                const isDue = checkIfDue(schedule);
                html += createScheduleItemHTML(schedule, isDue);
            });
            scheduleListElement.innerHTML = html;

            // Add event listeners to buttons
            scheduleArray.forEach(schedule => {
                const removeBtn = scheduleListElement.querySelector(`.remove-schedule-btn[data-id="${schedule.id}"]`);
                const toggleBtn = scheduleListElement.querySelector(`.toggle-schedule-btn[data-id="${schedule.id}"]`);

                if (removeBtn) {
                    removeBtn.addEventListener('click', () => removeSchedule(schedule.id));
                }
                if (toggleBtn) {
                    toggleBtn.addEventListener('click', () => toggleScheduleActive(schedule.id, !schedule.active));
                }
            });
        }

        function createScheduleItemHTML(schedule, isDue) {
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const scheduleDays = schedule.days ? schedule.days.map(d => dayNames[d]).join(', ') : 'Daily';

            const dueClass = isDue ? 'due-now' : '';
            const todayDate = new Date().toISOString().split('T')[0];
            const dispensedToday = schedule.lastDispensedDate === todayDate;

            const statusColor = dispensedToday ? 'badge-success' : 'badge-warning';
            const statusText = dispensedToday ? 'Dispensed' : 'Pending';

            return `
                <div class="schedule-item ${dueClass}" data-id="${schedule.id}">
                    <div class="schedule-header">
                        <div class="medicine-name">${schedule.name}</div>
                        <div class="medicine-time">${schedule.time}</div>
                    </div>
                    <div class="medicine-details">
                        <span>Purpose: ${schedule.dosage}</span>
                        <span class="badge ${statusColor}">${statusText}</span>
                    </div>
                    <div class="medicine-details">
                        
                        <div>
                            
                            <button class="btn btn-danger remove-schedule-btn" data-id="${schedule.id}" 
                                style="width: auto; padding: 5px 15px;">
                                <i class="fas fa-trash"></i> Remove
                            </button>
                        </div>
                    </div>
                </div>`;
        }

        function checkIfDue(schedule) {
            if (!lastRTCTime || schedule.dispensed || !schedule.active) return false;

            // Extract time from RTC time (format: HH:MM:SS)
            const [hours, minutes] = lastRTCTime.split(':');
            const currentTime = `${hours.padStart(2, '0')}:${minutes.padStart(2, '0')}`;

            return schedule.time === currentTime;
        }

        function removeSchedule(id) {
            if (confirm('Are you sure you want to remove this schedule?')) {
                if (db && scheduleRef) {
                    scheduleRef.child(id).remove()
                        .then(() => {
                            showToast('Schedule Removed', 'Medicine schedule deleted successfully', 'success');
                            addLog('Removed medicine schedule', 'warning');
                        })
                        .catch((error) => {
                            showToast('Error', 'Failed to remove schedule: ' + error.message, 'error');
                        });
                } else {
                    showToast('Demo Mode', 'Schedule removed (Demo Mode)', 'warning');
                    addLog('Removed medicine schedule (Demo)', 'warning');
                }
            }
        }

        function toggleScheduleActive(id, active) {
            if (db && scheduleRef) {
                scheduleRef.child(id).update({ active: active })
                    .then(() => {
                        const status = active ? 'activated' : 'deactivated';
                        showToast('Schedule Updated', `Schedule ${status} successfully`, 'success');
                        addLog(`Schedule ${status}`, 'warning');
                    })
                    .catch((error) => {
                        showToast('Error', 'Failed to update schedule: ' + error.message, 'error');
                    });
            }
        }

        function updateScheduleCounters(schedules) {
            if (!schedules) {
                document.getElementById('total-schedules').textContent = 'Total Schedules: 0';
                document.getElementById('active-count').textContent = '0 Active';
                return;
            }

            const total = Object.keys(schedules).length;
            const today = new Date().getDay();
            const todaySchedules = Object.values(schedules).filter(s =>
                s.days && s.days.includes(today) && s.active
            );

            const dispensedCount = todaySchedules.filter(s => s.dispensed).length;
            const pendingCount = todaySchedules.length - dispensedCount;

            document.getElementById('total-schedules').textContent = `Total Schedules: ${total}`;
            document.getElementById('active-count').textContent = `${todaySchedules.length} Active`;
            document.getElementById('dispensed-count').textContent = dispensedCount;
            document.getElementById('pending-count').textContent = pendingCount;
        }

        function startScheduleChecking() {
            if (scheduleCheckerInterval) {
                clearInterval(scheduleCheckerInterval);
            }

            scheduleCheckerInterval = setInterval(() => {
                if (lastRTCTime) {
                    checkScheduleAgainstTime(lastRTCTime);
                }
                updateNextCheckTimer();
            }, CHECK_INTERVAL);

            // Update timer every second
            setInterval(updateNextCheckTimer, 1000);
        }

        function checkScheduleAgainstTime(rtcTime) {
            if (!db || !scheduleRef) return;

            // Extract hour and minute from RTC time
            const timeParts = rtcTime.split(':');
            if (timeParts.length < 2) return;

            const currentTimeStr = timeParts[0].padStart(2, '0') + ':' + timeParts[1].padStart(2, '0');

            // Get current day
            const today = new Date().getDay();

            // Get all schedules
            scheduleRef.once('value').then((snapshot) => {
                const schedules = snapshot.val();
                if (!schedules) return;

                Object.values(schedules).forEach(schedule => {
                    const todayDate = new Date().toISOString().split('T')[0];

                    // Create unique debounce key per schedule per minute
                    const debounceKey = `${schedule.id}_${currentTimeStr}`;

                    if (
                        schedule.active &&
                        schedule.days &&
                        schedule.days.includes(today) &&
                        schedule.time === currentTimeStr &&
                        schedule.lastDispensedDate !== todayDate
                    ) {
                        // â›” Debounce check
                        if (scheduleDebounceMap[debounceKey]) return;

                        // âœ… Lock this schedule for this minute
                        scheduleDebounceMap[debounceKey] = true;

                        triggerAutoDispense(schedule, currentTimeStr);

                        // ðŸ”“ Auto-clear debounce after 70 seconds (safe window)
                        setTimeout(() => {
                            delete scheduleDebounceMap[debounceKey];
                        }, 70000);
                    }
                    setInterval(() => {
                        Object.keys(scheduleDebounceMap).forEach(key => {
                            const minute = key.split('_').pop();
                            const nowMinute = new Date().toTimeString().slice(0, 5);
                            if (minute !== nowMinute) {
                                delete scheduleDebounceMap[key];
                            }
                        });
                    }, 30000);


                });
            });

            lastScheduleCheck = Date.now();
        }

        function triggerAutoDispense(schedule, time) {
            if (!db || !commandsRef || !autoDispenseRef) return;

            console.log(`Triggering auto-dispense for ${schedule.name} at ${time}`);

            // Send commands with proper timing
            sendCommand('auto_dispense', true);

            // Don't send LED/Buzzer commands here - let ESP32 handle them
            // These are now handled in the dispenseMedicine() function

            // Update schedule as dispensed
            const now = new Date().toISOString();
            const todayDate = new Date().toISOString().split('T')[0];
            scheduleRef.child(schedule.id).update({
                lastDispensed: now,
                lastDispensedDate: todayDate
            });

            // Log the auto-dispense event
            addLog(`AUTO-DISPENSE: ${schedule.name} at ${time}`, 'success');

            // Update auto-dispense status
            autoDispenseRef.update({
                triggered: true,
                medicineName: schedule.name,
                time: time,
                timestamp: now
            }).then(() => {
                // Reset after 2 seconds
                setTimeout(() => {
                    autoDispenseRef.update({ triggered: false });
                }, 2000);
            });

            showToast('Auto Dispense', `Dispensing: ${schedule.name}`, 'success');
        }
        function sendCommand(command, value) {
            if (db && commandsRef) {
                commandsRef.child(command).set(value)
                    .then(() => {
                        // Reset command after a short delay (except for on/off commands)
                        if (!command.includes('_on') && !command.includes('_off')) {
                            setTimeout(() => {
                                commandsRef.child(command).set(false);
                            }, 5000);
                        }
                    })
                    .catch((error) => {
                        showToast('Command Error', 'Failed to send command: ' + error.message, 'error');
                    });
            } else {
                showToast('Demo Mode', `Command: ${command} (Demo)`, 'warning');
            }
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('current-time-display').textContent = timeString;
        }

        function updateRTCTimeDisplay(rtcTime) {
            document.getElementById('rtc-time-display').textContent = rtcTime;
            updateSyncStatus('Synchronized', 'success');
        }

        function forceTimeSync() {
            updateSyncStatus('Syncing...', 'syncing');

            // Send sync command to ESP32
            sendCommand('force_sync', true);

            // Update RTC time from system
            const now = new Date();
            const timeString =
                now.getHours().toString().padStart(2, '0') + ':' +
                now.getMinutes().toString().padStart(2, '0') + ':' +
                now.getSeconds().toString().padStart(2, '0');

            if (db && rtcRef) {
                rtcRef.set(timeString)
                    .then(() => {
                        updateSyncStatus('Synchronized', 'success');
                    })
                    .catch((error) => {
                        updateSyncStatus('Sync Failed', 'error');
                    });
            } else {
                updateSyncStatus('Synced (Demo)', 'success');
            }
        }

        function updateNextCheckTimer() {
            const elapsed = Math.floor((Date.now() - lastScheduleCheck) / 1000);
            const remaining = Math.max(0, CHECK_INTERVAL / 1000 - elapsed);
            document.getElementById('next-check-timer').textContent = remaining;

            // Update progress bar
            const progress = ((CHECK_INTERVAL / 1000 - remaining) / (CHECK_INTERVAL / 1000)) * 100;
            document.getElementById('schedule-progress').style.width = `${progress}%`;
        }

        function updateUptime() {
            const uptimeMs = Date.now() - systemStartTime;
            const hours = Math.floor(uptimeMs / 3600000);
            const minutes = Math.floor((uptimeMs % 3600000) / 60000);
            const seconds = Math.floor((uptimeMs % 60000) / 1000);

            document.getElementById('system-uptime').textContent =
                `Uptime: ${hours}h ${minutes}m ${seconds}s`;
        }

        function addLog(message, type = 'info') {
            const logListElement = document.getElementById('log-list');
            const logItem = document.createElement('div');
            logItem.className = `log-item log-${type}`;

            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });

            logItem.innerHTML = `
                <div class="log-type"></div>
                <div class="log-time">${timeString}</div>
                <div class="log-message">${message}</div>
            `;

            logListElement.insertBefore(logItem, logListElement.firstChild);

            // Keep only last 20 logs
            const logs = logListElement.querySelectorAll('.log-item');
            if (logs.length > 20) {
                logListElement.removeChild(logs[logs.length - 1]);
            }

            // Update log count
            document.getElementById('log-count').textContent = logs.length;

            // Also save to Firebase if connected
            if (db && logsRef && type !== 'demo') {
                const logData = {
                    message: message,
                    type: type,
                    timestamp: now.toISOString()
                };
                logsRef.push(logData);
            }
        }

        function updateLogDisplay(logs) {
            // This function handles live updates from Firebase
        }

        function clearLogs() {
            const logListElement = document.getElementById('log-list');
            logListElement.innerHTML = `
                <div class="log-item log-info">
                    <div class="log-type"></div>
                    <div class="log-time">[System]</div>
                    <div class="log-message">Logs cleared</div>
                </div>`;

            if (db && logsRef) {
                logsRef.remove()
                    .then(() => {
                        addLog('Logs cleared', 'warning');
                        showToast('Logs Cleared', 'All logs have been cleared', 'warning');
                    })
                    .catch((error) => {
                        showToast('Error', 'Failed to clear logs: ' + error.message, 'error');
                    });
            } else {
                addLog('Logs cleared (Demo Mode)', 'warning');
                showToast('Demo Mode', 'Logs cleared (Demo)', 'warning');
            }

            document.getElementById('log-count').textContent = '1';
        }

        function updateConnectionStatus(message, type) {
            if (!connectionStatusElement) return;

            connectionStatusElement.textContent = message;
            const statusDot = document.getElementById('status-dot');

            if (type === 'success') {
                statusDot.style.backgroundColor = 'var(--secondary)';
                statusDot.style.boxShadow = '0 0 20px var(--secondary)';
            } else if (type === 'error') {
                statusDot.style.backgroundColor = 'var(--danger)';
                statusDot.style.boxShadow = '0 0 20px var(--danger)';
            } else if (type === 'warning') {
                statusDot.style.backgroundColor = 'var(--warning)';
                statusDot.style.boxShadow = '0 0 20px var(--warning)';
            }
        }

        function updateFirebaseStatus(message) {
            if (firebaseStatusElement) {
                firebaseStatusElement.textContent = message;
            }
        }

        function updateSyncStatus(message, type) {
            const syncDot = document.getElementById('sync-dot');
            const syncStatusText = document.getElementById('sync-status-text');

            if (syncDot && syncStatusText) {
                syncStatusText.textContent = `Time Sync: ${message}`;
                syncDot.className = 'sync-dot';

                if (type === 'success') {
                    syncDot.classList.add('success');
                    syncDot.style.backgroundColor = 'var(--secondary)';
                } else if (type === 'error') {
                    syncDot.classList.add('error');
                    syncDot.style.backgroundColor = 'var(--danger)';
                } else if (type === 'syncing') {
                    syncDot.classList.add('syncing');
                    syncDot.style.backgroundColor = 'var(--warning)';
                }
            }
        }

        function showToast(title, message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastIcon = toast.querySelector('.toast-icon i');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');

            toast.className = `toast toast-${type}`;
            toastTitle.textContent = title;
            toastMessage.textContent = message;

            // Set icon based on type
            switch (type) {
                case 'success':
                    toastIcon.className = 'fas fa-check-circle';
                    break;
                case 'error':
                    toastIcon.className = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    toastIcon.className = 'fas fa-exclamation-triangle';
                    break;
                default:
                    toastIcon.className = 'fas fa-info-circle';
            }

            // Show toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);

            // Hide after 4 seconds
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        // Demo data for testing without Firebase
        function initializeDemoData() {
            addLog('Running in Demo Mode - No Firebase connection', 'warning');

            // Simulate RTC time updates every second
            setInterval(() => {
                const now = new Date();
                const rtcTime =
                    now.getHours().toString().padStart(2, '0') + ':' +
                    now.getMinutes().toString().padStart(2, '0') + ':' +
                    now.getSeconds().toString().padStart(2, '0');
                updateRTCTimeDisplay(rtcTime);

                // Simulate schedule checking
                if (Math.random() > 0.9) {
                    const demoMedicines = ['Vitamin C 500mg', 'Metformin 850mg', 'Aspirin 81mg'];
                    const randomMedicine = demoMedicines[Math.floor(Math.random() * demoMedicines.length)];
                    addLog(`DEMO: Auto-dispensing ${randomMedicine}`, 'success');
                }
            }, 1000);

            updateConnectionStatus('Demo Mode - Simulated System', 'warning');
            updateFirebaseStatus('Demo Mode');
        }
    </script>
</body>

</html>



